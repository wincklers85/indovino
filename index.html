<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>L'Indovino</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    :root {
      --bg: #050711;
      --bg-alt: #0c1020;
      --card-bg: #151a2c;
      --text: #ffffff;
      --muted: #a5acc7;
      --accent: #ffb400;
      --accent-soft: rgba(255,180,0,0.15);
      --danger: #ff4d6a;
      --border: rgba(255,255,255,0.08);
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.45);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --transition-fast: 0.2s ease-out;
      --transition-med: 0.28s ease-out;
      --blur-backdrop: blur(18px);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    body[data-theme="light"] {
      --bg: #f4f4fb;
      --bg-alt: #ffffff;
      --card-bg: #ffffff;
      --text: #14141f;
      --muted: #6e748b;
      --accent: #6c3bff;
      --accent-soft: rgba(108,59,255,0.1);
      --border: rgba(0,0,0,0.06);
      --shadow-soft: 0 16px 40px rgba(0,0,0,0.08);
    }

    body[data-theme="red"] {
      --bg: #1a0507;
      --bg-alt: #26080d;
      --card-bg: #330c13;
      --text: #ffeef0;
      --muted: #e9a3b0;
      --accent: #ff3355;
      --accent-soft: rgba(255,51,85,0.18);
      --border: rgba(255,255,255,0.08);
    }

    body[data-theme="blue"] {
      --bg: #020717;
      --bg-alt: #050c24;
      --card-bg: #071432;
      --text: #eaf0ff;
      --muted: #9eb2ff;
      --accent: #3ea8ff;
      --accent-soft: rgba(62,168,255,0.18);
      --border: rgba(255,255,255,0.09);
    }

    body[data-theme="green"] {
      --bg: #020f0a;
      --bg-alt: #04170f;
      --card-bg: #062015;
      --text: #e7fff4;
      --muted: #98e9c2;
      --accent: #35d38a;
      --accent-soft: rgba(53,211,138,0.18);
      --border: rgba(255,255,255,0.08);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #342155 0, var(--bg) 52%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
      display: none;
      flex-direction: column;
      gap: 14px;
      animation: fadeInApp 0.6s var(--transition-med) forwards;
    }

    @media (min-width: 900px) {
      .app-shell {
        padding: 24px 24px 28px;
      }
    }

    /* SPLASH SCREEN */

    .splash {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #442288 0, #0b0518 55%, #000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: #fdfbff;
      overflow: hidden;
      z-index: 999;
    }

    .splash-orb {
      position: absolute;
      width: 420px;
      height: 420px;
      border-radius: 50%;
      background: conic-gradient(from 220deg, rgba(255,255,255,0.12), rgba(0,0,0,0.2), rgba(255,255,255,0.15));
      filter: blur(26px);
      opacity: 0.9;
      animation: orbSpin 16s linear infinite;
    }

    .splash-card {
      position: relative;
      z-index: 1;
      padding: 26px 30px 22px;
      border-radius: 26px;
      background: radial-gradient(circle at top, rgba(255,255,255,0.22), rgba(10,3,25,0.92));
      box-shadow: 0 26px 60px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.15);
      backdrop-filter: blur(22px);
      text-align: center;
      max-width: 360px;
    }

    .wizard-circle {
      width: 120px;
      height: 120px;
      border-radius: 999px;
      margin: 0 auto 10px;
      background: radial-gradient(circle at 30% 20%, #fff 0, #fde3ff 22%, #8a6dff 65%, #281253 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,0.8);
    }

    .wizard-hat {
      font-size: 55px;
      animation: floatHat 2.2s ease-in-out infinite;
    }

    .wizard-orbit {
      position: absolute;
      inset: 10px;
      border-radius: inherit;
      border: 1px dashed rgba(255,255,255,0.35);
      animation: orbitSpin 12s linear infinite;
    }

    .splash-title {
      font-size: 32px;
      letter-spacing: 0.04em;
      font-weight: 700;
      margin-bottom: 4px;
      text-shadow: 0 6px 18px rgba(0,0,0,0.8);
    }

    .splash-sub {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 14px;
    }

    .splash-hint {
      font-size: 12px;
      opacity: 0.85;
    }

    .splash-progress {
      margin-top: 18px;
      height: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,0.15);
      overflow: hidden;
    }

    .splash-progress-fill {
      width: 0;
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg,#ffb400,#ff6f61,#64ffda);
      animation: splashProgress 2.2s ease-in-out forwards;
    }

    /* TOP BAR */

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      background: linear-gradient(120deg, rgba(6,10,30,0.95), rgba(10,16,48,0.9));
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: var(--shadow-soft);
      backdrop-filter: var(--blur-backdrop);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff 0, #ffe9b5 30%, var(--accent) 70%, #3b1d63 100%);
      box-shadow: 0 0 12px rgba(255,180,0,0.7);
      font-size: 20px;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title {
      font-size: 18px;
      font-weight: 650;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .app-subtitle {
      font-size: 11px;
      color: var(--muted);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .chip {
      border-radius: var(--radius-pill);
      padding: 5px 10px;
      font-size: 11px;
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.08);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
    }

    .chip strong {
      color: var(--text);
    }

    .nav-btn {
      border-radius: var(--radius-pill);
      padding: 6px 12px;
      font-size: 12px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), border var(--transition-fast), transform 0.1s ease-out;
    }

    .nav-btn span.icon {
      font-size: 15px;
    }

    .nav-btn:hover {
      background: rgba(255,255,255,0.05);
      color: var(--text);
      border-color: rgba(255,255,255,0.08);
      transform: translateY(-1px);
    }

    .nav-btn.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--text);
    }

    /* LAYOUT */

    .content {
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 14px;
    }

    @media (max-width: 800px) {
      .content {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: linear-gradient(145deg,var(--card-bg),var(--bg-alt));
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      font-size: 18px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .badge {
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(0,0,0,0.2);
      color: var(--muted);
    }

    .card-body {
      margin-top: 4px;
    }

    /* PROFILE LIST */

    .profile-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .profile-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.26);
      cursor: pointer;
      transition: background var(--transition-fast), transform 0.12s ease-out, border var(--transition-fast);
    }

    .profile-item-main {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .profile-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #fff 0, #ffe9b5 28%, var(--accent) 70%, #2b1144 100%);
      font-size: 16px;
      flex-shrink: 0;
    }

    .profile-meta {
      font-size: 11px;
      color: var(--muted);
    }

    .profile-actions {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .pill-btn {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 4px 9px;
      font-size: 11px;
      background: rgba(0,0,0,0.3);
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background var(--transition-fast), transform 0.1s ease-out, border var(--transition-fast);
    }

    .pill-btn span.icon {
      font-size: 13px;
    }

    .pill-btn:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
    }

    .pill-btn.danger {
      border-color: rgba(255,77,106,0.9);
      color: #ff9dad;
    }

    .pill-btn.danger:hover {
      background: rgba(255,77,106,0.16);
    }

    .pill-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .profile-empty {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* FORM */

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
      gap: 8px 10px;
      margin-top: 6px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 11px;
    }

    .form-group label {
      color: var(--muted);
    }

    .form-control, .form-select {
      border-radius: 9px;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 6px 8px;
      font-size: 12px;
      background: rgba(2,4,12,0.9);
      color: var(--text);
      outline: none;
      transition: border var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.08);
      background: rgba(5,8,20,0.98);
    }

    .form-row-inline {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: none;
      padding: 7px 12px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      transition: background var(--transition-fast), transform 0.1s ease-out, box-shadow var(--transition-fast), opacity var(--transition-fast);
    }

    .btn-primary {
      background: linear-gradient(135deg,var(--accent),#ffd86f);
      color: #23140a;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.65);
    }

    .btn-ghost {
      background: rgba(0,0,0,0.26);
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .btn-ghost:hover {
      background: rgba(255,255,255,0.06);
      color: var(--text);
    }

    .btn-sm {
      padding: 4px 10px;
      font-size: 11px;
    }

    .btn.disabled, .btn[disabled] {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* GAME MENU */

    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .game-card {
      position: relative;
      padding: 12px 12px 11px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.08);
      background: radial-gradient(circle at top,rgba(255,255,255,0.08),rgba(0,0,0,0.9));
      cursor: pointer;
      overflow: hidden;
      transition: transform var(--transition-med), box-shadow var(--transition-med), border var(--transition-fast), background var(--transition-med);
    }

    .game-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 38px rgba(0,0,0,0.7);
      border-color: rgba(255,255,255,0.22);
      background: radial-gradient(circle at top,var(--accent-soft),rgba(0,0,0,0.95));
    }

    .game-icon-badge {
      width: 34px;
      height: 34px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      background: rgba(0,0,0,0.4);
      margin-bottom: 4px;
    }

    .game-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .game-desc {
      font-size: 11px;
      color: var(--muted);
    }

    .game-chip {
      position: absolute;
      right: 10px;
      top: 10px;
      font-size: 10px;
      padding: 3px 7px;
      border-radius: var(--radius-pill);
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.18);
      color: var(--muted);
    }

    /* GAME VIEW GENERAL */

    .game-view {
      display: none;
      margin-top: 4px;
    }

    .game-view-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 6px;
      flex-wrap: wrap;
    }

    .breadcrumbs {
      font-size: 11px;
      color: var(--muted);
    }

    .breadcrumbs strong {
      color: var(--text);
    }

    .pill-info {
      font-size: 11px;
      color: var(--muted);
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      background: rgba(0,0,0,0.24);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .question-card {
      margin-top: 4px;
      padding: 10px 11px;
      border-radius: var(--radius-lg);
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .question-text {
      font-size: 14px;
      margin-bottom: 6px;
    }

    .answers-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }

    @media (min-width: 650px) {
      .answers-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .answer-btn {
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.14);
      padding: 7px 9px;
      font-size: 13px;
      background: rgba(5,8,20,0.9);
      color: var(--text);
      text-align: left;
      cursor: pointer;
      transition: background var(--transition-fast), transform 0.1s ease-out, border var(--transition-fast), box-shadow var(--transition-fast);
    }

    .answer-btn:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.5);
    }

    .answer-btn span.index {
      font-size: 11px;
      opacity: 0.7;
      margin-right: 4px;
    }

    .question-footer {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      flex-wrap: wrap;
      gap: 4px;
    }

    .result-box {
      margin-top: 8px;
      padding: 10px 11px;
      border-radius: var(--radius-lg);
      background: var(--accent-soft);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 12px 30px rgba(0,0,0,0.55);
      font-size: 13px;
    }

    .result-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .result-main {
      font-size: 14px;
      margin-bottom: 3px;
    }

    .result-meta {
      font-size: 11px;
      color: var(--muted);
    }

    /* MAGIC 8 BALL */

    .magic8-layout {
      display: grid;
      grid-template-columns: minmax(0,1.05fr) minmax(0,0.9fr);
      gap: 10px;
      margin-top: 4px;
    }

    @media (max-width: 800px) {
      .magic8-layout {
        grid-template-columns: 1fr;
      }
    }

    .magic8-ball {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      margin: 0 auto 4px;
      background: radial-gradient(circle at 30% 20%, #fff 0, #cfcfff 22%, #1a1740 55%, #02000a 100%);
      box-shadow: 0 20px 42px rgba(0,0,0,0.8);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .magic8-inner {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #3940ff 0, #14164f 60%, #050514 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e7ecff;
      font-size: 11px;
      text-align: center;
      padding: 6px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    /* 20 QUESTIONS */

    .twentyq-info {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 7px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-right: 4px;
    }

    /* SETTINGS & HISTORY */

    .theme-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .theme-pill {
      border-radius: var(--radius-pill);
      padding: 5px 10px;
      font-size: 11px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast), transform 0.1s ease-out, border var(--transition-fast);
    }

    .theme-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid rgba(0,0,0,0.6);
    }

    .theme-pill.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      transform: translateY(-1px);
    }

    .history-list {
      margin-top: 6px;
      max-height: 230px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .history-item {
      padding: 6px 8px;
      border-radius: 9px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.25);
      font-size: 11px;
      margin-bottom: 4px;
    }

    .history-item strong {
      font-size: 11px;
    }

    .history-meta {
      color: var(--muted);
      font-size: 10px;
      margin-top: 2px;
    }

    /* SCROLLBAR SMALL */

    .history-list::-webkit-scrollbar {
      width: 6px;
    }
    .history-list::-webkit-scrollbar-track {
      background: transparent;
    }
    .history-list::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.18);
      border-radius: 999px;
    }

    /* UTILITIES */

    .hidden {
      display: none !important;
    }

    .mt-4 { margin-top: 4px; }
    .mt-6 { margin-top: 6px; }
    .mt-8 { margin-top: 8px; }

    /* ANIMATIONS */

    @keyframes orbSpin {
      from { transform: rotate(0deg) scale(1); }
      to { transform: rotate(360deg) scale(1); }
    }

    @keyframes orbitSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes floatHat {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    @keyframes splashProgress {
      0% { width: 0; }
      100% { width: 100%; }
    }

    @keyframes fadeInApp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body data-theme="dark">
  <!-- SPLASH -->
  <div class="splash" id="splash">
    <div class="splash-orb"></div>
    <div class="splash-card">
      <div class="wizard-circle">
        <div class="wizard-orbit"></div>
        <div class="wizard-hat">üßô‚Äç‚ôÇÔ∏è</div>
      </div>
      <div class="splash-title">L‚ÄôINDOVINO</div>
      <div class="splash-sub">Quiz, numeri e un pizzico di magia per leggere il tuo futuro.</div>
      <div class="splash-hint">Sto calibrando i tarocchi scientifici‚Ä¶</div>
      <div class="splash-progress">
        <div class="splash-progress-fill"></div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div class="app-shell" id="app">
    <header class="topbar">
      <div class="topbar-left">
        <div class="logo-pill">üîÆ</div>
        <div class="title-group">
          <div class="app-title">L‚ÄôINDOVINO</div>
          <div class="app-subtitle">Motore probabilistico & giochi di previsione</div>
        </div>
      </div>
      <div class="topbar-right">
        <div class="chip">
          üë§ Profilo: <strong id="currentProfileLabel">Nessuno (modalit√† standard)</strong>
        </div>
        <button class="nav-btn active" data-view="homeView">
          <span class="icon">üè†</span> Home
        </button>
        <button class="nav-btn" data-view="profilesView">
          <span class="icon">üë•</span> Profili
        </button>
        <button class="nav-btn" data-view="settingsView">
          <span class="icon">‚öôÔ∏è</span> Impostazioni
        </button>
      </div>
    </header>

    <main class="content">
      <!-- LEFT: HOME / GIOCHI / GAME VIEWS -->
      <section class="card" id="homeView">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">‚ú®</span>
              Benvenuto nell‚ÄôOracolo
            </div>
            <div class="card-subtitle">
              Scegli un esperimento: le risposte useranno i dati del profilo per essere pi√π ‚Äúscientifiche‚Äù.
            </div>
          </div>
          <div class="badge">Modalit√† Quiz & Predizioni</div>
        </div>
        <div class="card-body">
          <!-- Menu giochi -->
          <div id="gamesMenu">
            <div class="game-grid">
              <div class="game-card" data-game="job">
                <div class="game-icon-badge">üíº</div>
                <div class="game-name">Che lavoro fa per me?</div>
                <div class="game-desc">Questionario strutturato (20 domande) con motore di matching professionale.</div>
                <div class="game-chip">Questionario</div>
              </div>
              <div class="game-card" data-game="kids">
                <div class="game-icon-badge">üë∂</div>
                <div class="game-name">Quanti figli avr√≤?</div>
                <div class="game-desc">Analisi stile di vita + preferenze per stimare una fascia probabile di figli.</div>
                <div class="game-chip">Stima probabilistica</div>
              </div>
              <div class="game-card" data-game="twentyq">
                <div class="game-icon-badge">üß†</div>
                <div class="game-name">Indovina a cosa sto pensando</div>
                <div class="game-desc">Famoso gioco delle 20 domande, fino a 40 tentativi. Vediamo chi vince‚Ä¶</div>
                <div class="game-chip">20Q Engine</div>
              </div>
              <div class="game-card" data-game="magic8">
                <div class="game-icon-badge">üé±</div>
                <div class="game-name">Magic 8 Ball</div>
                <div class="game-desc">Fai una domanda. L‚Äôoracolo combina caso e profilo per risponderti.</div>
                <div class="game-chip">Risposta istantanea</div>
              </div>
              <div class="game-card" data-game="tarot">
                <div class="game-icon-badge">üÉè</div>
                <div class="game-name">Tarocchi del Futuro</div>
                <div class="game-desc">Tirata a 3 carte: presente, sfida e possibile esito.</div>
                <div class="game-chip">Lettura simbolica</div>
              </div>
            </div>
          </div>

          <!-- GAME: JOB -->
          <div id="gameJob" class="game-view">
            <div class="game-view-header">
              <div class="breadcrumbs">
                <strong>L‚ÄôIndovino</strong> ¬∑ Che lavoro fa per me?
              </div>
              <div>
                <button class="btn btn-sm btn-ghost" data-back="job">‚¨Ö Torna ai giochi</button>
              </div>
            </div>
            <div class="pill-info">
              üîé Questo test combina 20 domande su interessi, valori e stile di vita con i dati di profilo (et√†, famiglia, contesto)
              per suggerire un campo professionale compatibile.
            </div>
            <div id="jobQuestionBox" class="question-card mt-6"></div>
            <div id="jobResult" class="result-box hidden"></div>
          </div>

          <!-- GAME: KIDS -->
          <div id="gameKids" class="game-view">
            <div class="game-view-header">
              <div class="breadcrumbs">
                <strong>L‚ÄôIndovino</strong> ¬∑ Quanti figli avr√≤?
              </div>
              <div>
                <button class="btn btn-sm btn-ghost" data-back="kids">‚¨Ö Torna ai giochi</button>
              </div>
            </div>
            <div class="pill-info">
              üë∂ Basato su preferenze, stile di vita e situazione familiare. Non √® una profezia, ma una stima ragionata.
            </div>
            <div id="kidsQuestionBox" class="question-card mt-6"></div>
            <div id="kidsResult" class="result-box hidden"></div>
          </div>

          <!-- GAME: 20Q -->
          <div id="gameTwentyQ" class="game-view">
            <div class="game-view-header">
              <div class="breadcrumbs">
                <strong>L‚ÄôIndovino</strong> ¬∑ Indovina a cosa sto pensando
              </div>
              <div>
                <button class="btn btn-sm btn-ghost" data-back="twentyq">‚¨Ö Torna ai giochi</button>
              </div>
            </div>
            <div class="twentyq-info">
              <span class="tag">Istruzioni</span>
              Pensa a <strong>una cosa comune</strong> (es. ‚Äúcane‚Äù, ‚Äúauto‚Äù, ‚Äúpizza‚Äù) e rispondi onestamente alle domande.
              L‚ÄôIndovino user√† un piccolo database di oggetti per provare a indovinare.  
              Fino a <strong>40 domande</strong>; se non ci riesce, hai vinto tu.
            </div>
            <div id="twentyQBox" class="question-card mt-6"></div>
            <div id="twentyQResult" class="result-box hidden"></div>
          </div>

          <!-- GAME: MAGIC 8 -->
          <div id="gameMagic8" class="game-view">
            <div class="game-view-header">
              <div class="breadcrumbs">
                <strong>L‚ÄôIndovino</strong> ¬∑ Magic 8 Ball</div>
              <div>
                <button class="btn btn-sm btn-ghost" data-back="magic8">‚¨Ö Torna ai giochi</button>
              </div>
            </div>
            <div class="magic8-layout">
              <div>
                <label class="form-group">
                  <span>La tua domanda all‚Äôoracolo</span>
                  <textarea id="magic8Question" class="form-control" rows="3"
                    placeholder="Esempio: &quot;Nei prossimi 2 anni cambier√≤ lavoro?&quot;"></textarea>
                </label>
                <div class="form-row-inline mt-6">
                  <button class="btn btn-primary" id="magic8AskBtn">
                    <span>Chiedi alla sfera</span> üé±
                  </button>
                  <button class="btn btn-ghost btn-sm" id="magic8ClearBtn">Pulisci</button>
                </div>
                <div id="magic8TextResult" class="result-box hidden mt-6"></div>
              </div>
              <div class="card" style="padding: 10px;">
                <div class="card-title" style="margin-bottom: 4px; font-size: 13px;">
                  <span class="icon">üé±</span> Sfera di previsione
                </div>
                <div class="card-subtitle" style="font-size: 11px;">
                  La risposta √® una combinazione di casualit√† e di coerenza col tuo profilo.
                </div>
                <div class="magic8-ball mt-6">
                  <div class="magic8-inner" id="magic8Inner">
                    Fai<br>una domanda
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- GAME: TAROT -->
          <div id="gameTarot" class="game-view">
            <div class="game-view-header">
              <div class="breadcrumbs">
                <strong>L‚ÄôIndovino</strong> ¬∑ Tarocchi del Futuro</div>
              <div>
                <button class="btn btn-sm btn-ghost" data-back="tarot">‚¨Ö Torna ai giochi</button>
              </div>
            </div>
            <div class="pill-info">
              üÉè Tirata a 3 carte (Presente ¬∑ Sfida ¬∑ Possibile esito). Lettura simbolica, da prendere con leggerezza.
            </div>
            <div class="form-row-inline mt-6">
              <button class="btn btn-primary btn-sm" id="tarotDrawBtn">Pesca le carte</button>
              <button class="btn btn-ghost btn-sm" id="tarotResetBtn">Azzera lettura</button>
            </div>
            <div id="tarotResult" class="result-box hidden mt-6"></div>
          </div>
        </div>
      </section>

      <!-- RIGHT: PROFILI / IMPOSTAZIONI / STORICO -->
      <section class="card" id="profilesView">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">üë•</span>
              Profili utente
            </div>
            <div class="card-subtitle">
              Fino a 5 profili salvati in locale (nessun dato va su internet).
            </div>
          </div>
          <div class="badge" id="profilesBadge">0 / 5</div>
        </div>
        <div class="card-body">
          <div class="profile-list" id="profilesList"></div>
          <div id="profilesEmpty" class="profile-empty hidden">
            Nessun profilo configurato. Puoi usarlo anche senza profilo, ma con un profilo le stime sono pi√π personalizzate.
          </div>

          <hr style="border: none; border-top: 1px solid rgba(255,255,255,0.06); margin: 10px 0;">

          <div class="card-title" style="font-size: 14px; margin-bottom: 4px;">
            <span class="icon">‚ûï</span> Crea / modifica profilo
          </div>
          <div class="form-grid mt-4">
            <div class="form-group">
              <label>Nome</label>
              <input id="pfNome" class="form-control" placeholder="Mario">
            </div>
            <div class="form-group">
              <label>Cognome</label>
              <input id="pfCognome" class="form-control" placeholder="Rossi">
            </div>
            <div class="form-group">
              <label>Data di nascita</label>
              <input id="pfDob" class="form-control" type="date">
            </div>
            <div class="form-group">
              <label>Sesso</label>
              <select id="pfSesso" class="form-select">
                <option value="">Seleziona...</option>
                <option value="M">Maschio</option>
                <option value="F">Femmina</option>
                <option value="X">Altro / Preferisco non dirlo</option>
              </select>
            </div>
            <div class="form-group">
              <label>Sposato/a</label>
              <select id="pfSposato" class="form-select">
                <option value="">Seleziona...</option>
                <option value="si">S√¨</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="form-group">
              <label>Hai figli?</label>
              <select id="pfHaFigli" class="form-select">
                <option value="">Seleziona...</option>
                <option value="no">No</option>
                <option value="si">S√¨</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quanti figli (se presenti)</label>
              <input id="pfNumFigli" type="number" min="0" class="form-control" placeholder="0">
            </div>
            <div class="form-group">
              <label>Guida (patente / veicolo)?</label>
              <select id="pfGuida" class="form-select">
                <option value="">Seleziona...</option>
                <option value="si">S√¨</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="form-group">
              <label>Animali domestici</label>
              <select id="pfAnimali" class="form-select">
                <option value="">Seleziona...</option>
                <option value="no">No</option>
                <option value="si">S√¨</option>
              </select>
            </div>
            <div class="form-group">
              <label>Lavori attualmente?</label>
              <select id="pfLavora" class="form-select">
                <option value="">Seleziona...</option>
                <option value="si">S√¨</option>
                <option value="no">No</option>
                <option value="studio">Studio</option>
              </select>
            </div>
            <div class="form-group">
              <label>Casa di propriet√†</label>
              <select id="pfCasa" class="form-select">
                <option value="">Seleziona...</option>
                <option value="proprieta">S√¨, di propriet√†</option>
                <option value="affitto">No, in affitto</option>
                <option value="altro">Altro</option>
              </select>
            </div>
            <div class="form-group">
              <label>Dove vivi?</label>
              <select id="pfZona" class="form-select">
                <option value="">Seleziona...</option>
                <option value="mare">Al mare</option>
                <option value="montagna">In montagna</option>
                <option value="citta">In citt√† / pianura</option>
              </select>
            </div>
            <div class="form-group">
              <label>Vuoi trasferirti entro 7 anni?</label>
              <select id="pfTrasferirsi" class="form-select">
                <option value="">Seleziona...</option>
                <option value="si">S√¨</option>
                <option value="no">No</option>
                <option value="forse">Forse / dipende</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ti piace dove vivi?</label>
              <select id="pfPiaceZona" class="form-select">
                <option value="">Seleziona...</option>
                <option value="si">S√¨, molto</option>
                <option value="abbastanza">Abbastanza</option>
                <option value="cosi_cosi">Cos√¨ cos√¨</option>
                <option value="no">No</option>
              </select>
            </div>
          </div>
          <div class="form-row-inline mt-8">
            <button class="btn btn-primary" id="saveProfileBtn">
              üíæ Salva profilo
            </button>
            <button class="btn btn-ghost btn-sm" id="clearProfileFormBtn">
              Pulisci modulo
            </button>
            <button class="btn btn-ghost btn-sm" id="noProfileBtn">
              Continua senza profilo
            </button>
          </div>
        </div>
      </section>

      <section class="card hidden" id="settingsView">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">‚öôÔ∏è</span>
              Impostazioni & storico
            </div>
            <div class="card-subtitle">
              Personalizza il tema e guarda le sessioni precedenti.
            </div>
          </div>
          <div class="badge">Tema & Log</div>
        </div>
        <div class="card-body">
          <div class="card-title" style="font-size: 14px;">Tema</div>
          <div class="card-subtitle" style="margin-bottom: 4px;">
            Scegli il look dell‚Äôoracolo. L‚Äôimpostazione √® salvata sul dispositivo.
          </div>
          <div class="theme-row" id="themeRow">
            <button class="theme-pill" data-theme="dark">
              <div class="theme-dot" style="background: radial-gradient(circle,#ffffff,#050711);"></div>
              Scuro
            </button>
            <button class="theme-pill" data-theme="light">
              <div class="theme-dot" style="background: #f0f0ff;"></div>
              Chiaro
            </button>
            <button class="theme-pill" data-theme="red">
              <div class="theme-dot" style="background: #d8264c;"></div>
              Rosso
            </button>
            <button class="theme-pill" data-theme="blue">
              <div class="theme-dot" style="background: #236cff;"></div>
              Azzurro
            </button>
            <button class="theme-pill" data-theme="green">
              <div class="theme-dot" style="background: #1ebb6f;"></div>
              Verde
            </button>
          </div>

          <hr style="border: none; border-top: 1px solid rgba(255,255,255,0.06); margin: 10px 0;">

          <div class="card-title" style="font-size: 14px;">Risultati passati</div>
          <div class="card-subtitle">
            Ultime sessioni di giochi e letture. Puoi usarle per confrontare nel tempo le tue risposte.
          </div>
          <div class="history-list" id="historyList"></div>
          <div class="form-row-inline mt-6">
            <button class="btn btn-ghost btn-sm" id="clearHistoryBtn">Pulisci storico</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ================== COSTANTI & STORAGE ==================
    const MAX_PROFILES = 5;
    const STORAGE_KEYS = {
      profiles: 'indovino_profiles',
      theme: 'indovino_theme',
      history: 'indovino_history',
      currentProfileIndex: 'indovino_current_profile'
    };

    function loadJSON(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);
      } catch {
        return fallback;
      }
    }

    function saveJSON(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch {}
    }

    // Profili
    let profiles = loadJSON(STORAGE_KEYS.profiles, []);
    let currentProfileIndex = loadJSON(STORAGE_KEYS.currentProfileIndex, null);
    let historyLog = loadJSON(STORAGE_KEYS.history, []);

    // Tema
    let initialTheme = localStorage.getItem(STORAGE_KEYS.theme) || 'dark';
    document.body.setAttribute('data-theme', initialTheme);

    // Profilo "standard" se nessun profilo √® selezionato
    function getCurrentProfile() {
      if (currentProfileIndex == null || profiles.length === 0 || !profiles[currentProfileIndex]) {
        return {
          name: 'Standard',
          surname: '',
          dob: '',
          sesso: '',
          sposato: 'no',
          haFigli: 'no',
          numFigli: 0,
          guida: 'si',
          animali: 'no',
          lavora: 'si',
          casa: 'affitto',
          zona: 'citta',
          trasferirsi: 'forse',
          piaceZona: 'abbastanza'
        };
      }
      return profiles[currentProfileIndex];
    }

    function updateCurrentProfileLabel() {
      const label = document.getElementById('currentProfileLabel');
      const prof = getCurrentProfile();
      if (!profiles.length || currentProfileIndex == null || !profiles[currentProfileIndex]) {
        label.textContent = 'Nessuno (modalit√† standard)';
      } else {
        label.textContent = prof.name + ' ' + prof.surname;
      }
    }

    // ================== UI BASICS ==================

    const appShell = document.getElementById('app');
    const splash = document.getElementById('splash');

    // Splash -> App
    function hideSplash() {
      splash.style.opacity = '0';
      splash.style.pointerEvents = 'none';
      setTimeout(() => {
        splash.style.display = 'none';
        appShell.style.display = 'flex';
      }, 260);
    }
    setTimeout(hideSplash, 2300);
    splash.addEventListener('click', hideSplash);

    // NAV tra viste (home, profili, impostazioni)
    const navButtons = Array.from(document.querySelectorAll('.nav-btn'));
    function showView(viewId) {
      document.getElementById('homeView').classList.add('hidden');
      document.getElementById('profilesView').classList.add('hidden');
      document.getElementById('settingsView').classList.add('hidden');
      document.getElementById(viewId).classList.remove('hidden');

      navButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === viewId);
      });
    }

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        showView(btn.dataset.view);
      });
    });

    // ================== PROFILI ==================

    const profilesList = document.getElementById('profilesList');
    const profilesEmpty = document.getElementById('profilesEmpty');
    const profilesBadge = document.getElementById('profilesBadge');

    function renderProfiles() {
      profilesList.innerHTML = '';
      if (!profiles.length) {
        profilesEmpty.classList.remove('hidden');
      } else {
        profilesEmpty.classList.add('hidden');
      }
      profilesBadge.textContent = profiles.length + ' / ' + MAX_PROFILES;

      profiles.forEach((p, idx) => {
        const item = document.createElement('div');
        item.className = 'profile-item';

        const main = document.createElement('div');
        main.className = 'profile-item-main';
        const avatar = document.createElement('div');
        avatar.className = 'profile-avatar';
        avatar.textContent = 'üë§';
        const right = document.createElement('div');
        const nameEl = document.createElement('div');
        nameEl.textContent = p.name + ' ' + p.surname;
        nameEl.style.fontWeight = '500';
        const meta = document.createElement('div');
        meta.className = 'profile-meta';
        const parts = [];
        if (p.dob) parts.push('Nato il ' + p.dob);
        if (p.zona) {
          let area = p.zona === 'mare' ? 'mare' : p.zona === 'montagna' ? 'montagna' : 'citt√†';
          parts.push('Zona: ' + area);
        }
        meta.textContent = parts.join(' ¬∑ ');
        right.appendChild(nameEl);
        right.appendChild(meta);
        main.appendChild(avatar);
        main.appendChild(right);

        const actions = document.createElement('div');
        actions.className = 'profile-actions';
        const useBtn = document.createElement('button');
        useBtn.className = 'pill-btn btn-sm';
        useBtn.innerHTML = '<span class="icon">‚ú®</span> Usa';
        useBtn.addEventListener('click', () => {
          currentProfileIndex = idx;
          saveJSON(STORAGE_KEYS.currentProfileIndex, currentProfileIndex);
          updateCurrentProfileLabel();
        });

        const delBtn = document.createElement('button');
        delBtn.className = 'pill-btn btn-sm danger';
        delBtn.innerHTML = '<span class="icon">üóë</span>';
        delBtn.title = 'Elimina profilo';
        delBtn.addEventListener('click', () => {
          if (confirm('Eliminare il profilo "' + p.name + ' ' + p.surname + '"?')) {
            profiles.splice(idx, 1);
            if (currentProfileIndex === idx) currentProfileIndex = null;
            if (currentProfileIndex != null && currentProfileIndex > idx) {
              currentProfileIndex--;
            }
            saveJSON(STORAGE_KEYS.profiles, profiles);
            saveJSON(STORAGE_KEYS.currentProfileIndex, currentProfileIndex);
            renderProfiles();
            updateCurrentProfileLabel();
            updateCreateProfileButtonState();
          }
        });

        actions.appendChild(useBtn);
        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        profilesList.appendChild(item);
      });

      updateCreateProfileButtonState();
    }

    // Form profilo
    const pfNome = document.getElementById('pfNome');
    const pfCognome = document.getElementById('pfCognome');
    const pfDob = document.getElementById('pfDob');
    const pfSesso = document.getElementById('pfSesso');
    const pfSposato = document.getElementById('pfSposato');
    const pfHaFigli = document.getElementById('pfHaFigli');
    const pfNumFigli = document.getElementById('pfNumFigli');
    const pfGuida = document.getElementById('pfGuida');
    const pfAnimali = document.getElementById('pfAnimali');
    const pfLavora = document.getElementById('pfLavora');
    const pfCasa = document.getElementById('pfCasa');
    const pfZona = document.getElementById('pfZona');
    const pfTrasferirsi = document.getElementById('pfTrasferirsi');
    const pfPiaceZona = document.getElementById('pfPiaceZona');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    const clearProfileFormBtn = document.getElementById('clearProfileFormBtn');
    const noProfileBtn = document.getElementById('noProfileBtn');

    function clearProfileForm() {
      pfNome.value = '';
      pfCognome.value = '';
      pfDob.value = '';
      pfSesso.value = '';
      pfSposato.value = '';
      pfHaFigli.value = '';
      pfNumFigli.value = '';
      pfGuida.value = '';
      pfAnimali.value = '';
      pfLavora.value = '';
      pfCasa.value = '';
      pfZona.value = '';
      pfTrasferirsi.value = '';
      pfPiaceZona.value = '';
    }

    function updateCreateProfileButtonState() {
      if (profiles.length >= MAX_PROFILES) {
        saveProfileBtn.classList.add('disabled');
        saveProfileBtn.disabled = true;
      } else {
        saveProfileBtn.classList.remove('disabled');
        saveProfileBtn.disabled = false;
      }
    }

    saveProfileBtn.addEventListener('click', () => {
      if (profiles.length >= MAX_PROFILES) {
        alert('Hai gi√† 5 profili. Cancella un profilo prima di crearne un altro.');
        return;
      }
      const newProfile = {
        name: pfNome.value.trim(),
        surname: pfCognome.value.trim(),
        dob: pfDob.value || '',
        sesso: pfSesso.value || '',
        sposato: pfSposato.value || '',
        haFigli: pfHaFigli.value || '',
        numFigli: Number(pfNumFigli.value || '0'),
        guida: pfGuida.value || '',
        animali: pfAnimali.value || '',
        lavora: pfLavora.value || '',
        casa: pfCasa.value || '',
        zona: pfZona.value || '',
        trasferirsi: pfTrasferirsi.value || '',
        piaceZona: pfPiaceZona.value || ''
      };
      if (!newProfile.name || !newProfile.surname) {
        alert('Inserisci almeno nome e cognome.');
        return;
      }
      profiles.push(newProfile);
      saveJSON(STORAGE_KEYS.profiles, profiles);
      currentProfileIndex = profiles.length - 1;
      saveJSON(STORAGE_KEYS.currentProfileIndex, currentProfileIndex);
      renderProfiles();
      updateCurrentProfileLabel();
      clearProfileForm();
      alert('Profilo salvato!');
    });

    clearProfileFormBtn.addEventListener('click', clearProfileForm);

    noProfileBtn.addEventListener('click', () => {
      currentProfileIndex = null;
      saveJSON(STORAGE_KEYS.currentProfileIndex, currentProfileIndex);
      updateCurrentProfileLabel();
      alert('Ora sei in modalit√† senza profilo (parametri standard).');
    });

    // ================== TEMI & STORICO ==================

    const themeRow = document.getElementById('themeRow');

    function applyTheme(themeKey) {
      document.body.setAttribute('data-theme', themeKey);
      localStorage.setItem(STORAGE_KEYS.theme, themeKey);
      Array.from(themeRow.querySelectorAll('.theme-pill')).forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === themeKey);
      });
    }

    Array.from(themeRow.querySelectorAll('.theme-pill')).forEach(btn => {
      btn.addEventListener('click', () => {
        applyTheme(btn.dataset.theme);
      });
    });
    applyTheme(initialTheme);

    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');

    function addHistoryEntry(game, summary) {
      const prof = getCurrentProfile();
      const ts = new Date();
      historyLog.unshift({
        game,
        summary,
        profileName: (profiles.length && currentProfileIndex != null && profiles[currentProfileIndex])
          ? (prof.name + ' ' + prof.surname)
          : 'Standard / nessun profilo',
        timestamp: ts.toISOString()
      });
      historyLog = historyLog.slice(0, 50); // massimo 50 record
      saveJSON(STORAGE_KEYS.history, historyLog);
      renderHistory();
    }

    function renderHistory() {
      historyList.innerHTML = '';
      if (!historyLog.length) {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.textContent = 'Nessuna sessione registrata finora.';
        historyList.appendChild(div);
        return;
      }
      historyLog.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        const main = document.createElement('div');
        main.innerHTML = '<strong>' + item.game + '</strong>: ' + item.summary;
        const meta = document.createElement('div');
        meta.className = 'history-meta';
        const d = new Date(item.timestamp);
        meta.textContent = item.profileName + ' ¬∑ ' +
          d.toLocaleDateString('it-IT') + ' ' +
          d.toLocaleTimeString('it-IT', {hour: '2-digit', minute: '2-digit'});
        div.appendChild(main);
        div.appendChild(meta);
        historyList.appendChild(div);
      });
    }

    clearHistoryBtn.addEventListener('click', () => {
      if (!historyLog.length) return;
      if (confirm('Cancellare tutto lo storico dei risultati?')) {
        historyLog = [];
        saveJSON(STORAGE_KEYS.history, historyLog);
        renderHistory();
      }
    });

    // ================== GIOCHI: NAVIGATION ==================

    const gamesMenu = document.getElementById('gamesMenu');
    const gameViews = {
      job: document.getElementById('gameJob'),
      kids: document.getElementById('gameKids'),
      twentyq: document.getElementById('gameTwentyQ'),
      magic8: document.getElementById('gameMagic8'),
      tarot: document.getElementById('gameTarot')
    };

    function showGame(gameKey) {
      gamesMenu.style.display = 'none';
      Object.values(gameViews).forEach(v => v.style.display = 'none');
      const view = gameViews[gameKey];
      if (view) view.style.display = 'block';
    }

    function backToGames(from) {
      // reset game UIs minimi
      if (from === 'job') {
        jobState.currentIndex = 0;
        jobState.scores = [0,0,0,0,0,0];
        renderJobQuestion();
        document.getElementById('jobResult').classList.add('hidden');
      }
      if (from === 'kids') {
        kidsState.currentIndex = 0;
        kidsState.score = 0;
        renderKidsQuestion();
        document.getElementById('kidsResult').classList.add('hidden');
      }
      if (from === 'twentyq') {
        resetTwentyQ();
      }
      if (from === 'magic8') {
        document.getElementById('magic8Question').value = '';
        document.getElementById('magic8Inner').textContent = 'Fai\nuna domanda';
        document.getElementById('magic8TextResult').classList.add('hidden');
      }
      if (from === 'tarot') {
        document.getElementById('tarotResult').classList.add('hidden');
      }

      gamesMenu.style.display = 'block';
      Object.values(gameViews).forEach(v => v.style.display = 'none');
    }

    Array.from(document.querySelectorAll('[data-back]')).forEach(btn => {
      btn.addEventListener('click', () => {
        backToGames(btn.dataset.back);
      });
    });

    Array.from(document.querySelectorAll('.game-card')).forEach(card => {
      card.addEventListener('click', () => {
        const gameKey = card.dataset.game;
        showGame(gameKey);
        if (gameKey === 'job') renderJobQuestion();
        if (gameKey === 'kids') renderKidsQuestion();
        if (gameKey === 'twentyq') startTwentyQ();
      });
    });

    // ================== GIOCO: CHE LAVORO FA PER ME? ==================

    // categorie: 0 Tecnico, 1 Sanitario, 2 Educativo, 3 Business, 4 Creativo, 5 Manuale/Outdoor
    const careerCategories = [
      'Area tecnica / ingegneristica',
      'Area sanitaria / assistenziale',
      'Area educativa / sociale',
      'Area business / organizzativa',
      'Area creativa / digitale',
      'Area manuale / outdoor'
    ];

    const jobQuestions = [
      {
        text: 'A scuola quali materie ti piacevano di pi√π?',
        options: [
          'Matematica, fisica, informatica',
          'Biologia, scienze, educazione fisica',
          'Italiano, storia, filosofia',
          'Arte, musica, disegno'
        ],
        scores: [
          [2,0,0,1,0,0],
          [0,2,0,0,0,1],
          [0,0,2,0,0,0],
          [0,0,0,0,2,0]
        ]
      },
      {
        text: 'Come ti descriveresti quando lavori su un problema?',
        options: [
          'Analitico, cerco la soluzione logica',
          'Empatico, penso alle persone coinvolte',
          'Pratico, mi metto subito a fare',
          'Creativo, cerco una soluzione originale'
        ],
        scores: [
          [2,0,0,0,0,0],
          [0,2,1,0,0,0],
          [0,0,0,0,0,2],
          [0,0,0,0,2,0]
        ]
      },
      {
        text: 'Come ti senti con la tecnologia?',
        options: [
          'Mi piace smanettare, capisco abbastanza',
          'La uso ma senza esagerare',
          'La uso solo se devo',
          'Preferisco attivit√† lontane dagli schermi'
        ],
        scores: [
          [2,0,0,0,1,0],
          [0,0,0,0,1,0],
          [0,0,0,0,0,0],
          [0,0,0,0,0,2]
        ]
      },
      {
        text: 'Ti piace stare a contatto con le persone?',
        options: [
          'S√¨, tantissimo, adoro parlare con la gente',
          'Mi piace, ma ho bisogno anche dei miei spazi',
          'Solo quando serve, preferisco i miei progetti',
          'No, preferisco lavorare da solo'
        ],
        scores: [
          [0,1,2,1,0,0],
          [0,0,1,0,0,0],
          [1,0,0,0,0,0],
          [1,0,0,0,0,0]
        ]
      },
      {
        text: 'Quanto ti attira l‚Äôidea di aiutare gli altri concretamente (salute, supporto, ascolto)?',
        options: [
          '√à una parte centrale di ci√≤ che vorrei fare',
          'Mi piace, ma non vorrei fosse il 100% del lavoro',
          'Mi interessa ma pi√π da lontano',
          'Non √® una priorit√† per me'
        ],
        scores: [
          [0,3,1,0,0,0],
          [0,1,1,0,0,0],
          [0,0,0,0,0,0],
          [0,0,0,1,0,0]
        ]
      },
      {
        text: 'Ti immagini pi√π in ufficio, laboratorio, scuola o all‚Äôaperto?',
        options: [
          'Ufficio o laboratorio tecnologico',
          'Ospedale, studio medico o simile',
          'Scuola, formazione, centri educativi',
          'All‚Äôaperto / sul campo'
        ],
        scores: [
          [2,0,0,1,0,0],
          [0,2,0,0,0,0],
          [0,0,2,0,0,0],
          [0,0,0,0,0,3]
        ]
      },
      {
        text: 'Con i bambini come ti trovi?',
        options: [
          'Benissimo, ho pazienza e mi diverto',
          'Mi piacciono, ma a piccole dosi',
          'Non sono molto portato',
          'Dipende dal bambino‚Ä¶'
        ],
        scores: [
          [0,0,3,0,0,0],
          [0,0,1,0,0,0],
          [0,0,0,0,0,0],
          [0,0,1,0,0,0]
        ]
      },
      {
        text: 'Quanto ti piace assumerti responsabilit√† e prendere decisioni?',
        options: [
          'Molto, mi piace decidere e coordinare',
          'Se serve lo faccio',
          'Preferisco che decida qualcun altro',
          'Dipende dalla situazione'
        ],
        scores: [
          [0,0,0,3,0,0],
          [1,0,0,1,0,0],
          [0,0,0,0,0,0],
          [0,0,0,1,0,0]
        ]
      },
      {
        text: 'Come ti senti con lavori manuali (attrezzi, bricolage, riparazioni)?',
        options: [
          'Mi piacciono moltissimo',
          'Li so fare ma non sono la mia passione',
          'Ogni tanto, ma niente di che',
          'Preferisco lavori non manuali'
        ],
        scores: [
          [0,0,0,0,0,3],
          [1,0,0,0,0,1],
          [0,0,0,0,0,0],
          [0,0,0,0,0,0]
        ]
      },
      {
        text: 'Come ti vedi con orari e routine?',
        options: [
          'Orari fissi e sicuri, meglio',
          'Un po‚Äô di flessibilit√†, ma con ordine',
          'Flessibilit√† totale, anche orari strani',
          'Dipende dal tipo di lavoro'
        ],
        scores: [
          [1,1,0,0,0,0],
          [0,0,1,0,0,0],
          [0,0,0,2,1,1],
          [0,0,0,1,0,0]
        ]
      },
      {
        text: 'Quanto ti attira l‚Äôidea di ‚Äúcreare‚Äù (contenuti, design, musica, scrittura)?',
        options: [
          'Tantissimo, √® ci√≤ che vorrei fare',
          'Abbastanza, come parte del lavoro',
          'Non √® una priorit√†',
          'Non mi interessa quasi per nulla'
        ],
        scores: [
          [0,0,0,0,3,0],
          [0,0,0,0,1,0],
          [0,0,0,0,0,0],
          [0,0,0,0,0,0]
        ]
      },
      {
        text: 'Quando pensi al futuro, cosa ti importa di pi√π?',
        options: [
          'Stabilit√† economica e sicurezza',
          'Sentirmi utile e fare la differenza',
          'Sentirmi libero e indipendente',
          'Esprimermi e non annoiarmi'
        ],
        scores: [
          [0,0,0,2,0,0],
          [0,2,0,0,0,0],
          [0,0,0,2,1,1],
          [0,0,0,0,2,0]
        ]
      },
      {
        text: 'Quanto ti infastidisce l‚Äôidea di studiare/aggiornarti spesso?',
        options: [
          'Mi piace, non √® un problema',
          'Lo accetto se serve',
          'Preferisco qualcosa di pi√π ripetitivo',
          'Dipende dall‚Äôargomento'
        ],
        scores: [
          [2,1,1,1,1,0],
          [1,1,0,0,0,0],
          [0,0,0,0,0,1],
          [0,0,0,0,0,0]
        ]
      },
      {
        text: 'Come ti senti a parlare davanti a un gruppo?',
        options: [
          'Mi piace, mi viene naturale',
          'Posso farlo, ma con un po‚Äô di ansia',
          'Lo eviterei volentieri',
          'Solo se strettamente necessario'
        ],
        scores: [
          [0,0,1,2,0,0],
          [0,0,1,1,0,0],
          [0,0,0,0,0,0],
          [0,0,0,1,0,0]
        ]
      },
      {
        text: 'Ti piace l‚Äôidea di lavorare su progetti lunghi (mesi/anni)?',
        options: [
          'S√¨, amo i progetti lunghi',
          'Preferisco alternare breve e lungo',
          'Meglio attivit√† brevi e varie',
          'Non lo so / dipende'
        ],
        scores: [
          [2,0,0,1,0,0],
          [1,0,0,1,0,0],
          [0,0,0,0,1,1],
          [0,0,0,0,0,0]
        ]
      },
      {
        text: 'Quanto ti pesa vedere sangue o situazioni ‚Äúforti‚Äù?',
        options: [
          'Non mi d√† problemi',
          'Mi impressiona un po‚Äô, ma ci starei',
          'Mi d√† parecchio fastidio',
          'Le eviterei totalmente'
        ],
        scores: [
          [0,2,0,0,0,0],
          [0,1,0,0,0,0],
          [0,0,0,0,0,0],
          [0,0,0,0,0,0]
        ]
      },
      {
        text: 'Se dovessi scegliere un motto lavorativo, quale ti rispecchia di pi√π?',
        options: [
          '‚ÄúSe √® rotto, lo aggiusto‚Äù',
          '‚ÄúSe soffre, lo aiuto‚Äù',
          '‚ÄúSe non capisce, glielo spiego‚Äù',
          '‚ÄúSe √® noioso, lo reinvento‚Äù'
        ],
        scores: [
          [2,0,0,0,0,2],
          [0,3,0,0,0,0],
          [0,0,3,0,0,0],
          [0,0,0,0,3,0]
        ]
      },
      {
        text: 'Quanto sei disposto a rischiare per un progetto tuo?',
        options: [
          'Molto, potrei anche aprire un‚Äôattivit√†',
          'Un po‚Äô, ma con una base sicura',
          'Poco, preferisco il posto fisso',
          'Dipende dalla fase della vita'
        ],
        scores: [
          [0,0,0,3,1,0],
          [0,0,0,2,0,0],
          [0,0,0,1,0,0],
          [0,0,0,1,0,0]
        ]
      },
      {
        text: 'Quando hai del tempo libero, cosa ti rilassa di pi√π?',
        options: [
          'Smanettare con tecnologia, giochi, progetti',
          'Uscire con amici / famiglia',
          'Attivit√† creative (foto, video, musica, disegno)',
          'Sport, natura, movimento'
        ],
        scores: [
          [2,0,0,0,1,0],
          [0,1,1,0,0,0],
          [0,0,0,0,3,0],
          [0,0,0,0,0,3]
        ]
      },
      {
        text: 'Se ti dicessero ‚Äúdomani cambi lavoro‚Äù, cosa ti emozionerebbe di pi√π?',
        options: [
          'Un ruolo pi√π tecnico / specialistico',
          'Un ruolo dove aiuto pi√π persone',
          'Un ruolo dove gestisco un team o un progetto',
          'Un ruolo dove posso creare contenuti / idee'
        ],
        scores: [
          [3,0,0,0,0,0],
          [0,3,0,0,0,0],
          [0,0,0,3,0,0],
          [0,0,0,0,3,0]
        ]
      }
    ];

    const jobQuestionBox = document.getElementById('jobQuestionBox');
    const jobResultBox = document.getElementById('jobResult');

    const jobState = {
      currentIndex: 0,
      scores: [0,0,0,0,0,0]
    };

    function renderJobQuestion() {
      jobResultBox.classList.add('hidden');
      const idx = jobState.currentIndex;
      if (idx >= jobQuestions.length) {
        showJobResult();
        return;
      }
      const q = jobQuestions[idx];
      jobQuestionBox.innerHTML = '';

      const qText = document.createElement('div');
      qText.className = 'question-text';
      qText.textContent = (idx + 1) + '. ' + q.text;
      jobQuestionBox.appendChild(qText);

      const answers = document.createElement('div');
      answers.className = 'answers-grid';
      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.innerHTML = '<span class="index">' + String.fromCharCode(65 + i) + ')</span> ' + opt;
        btn.addEventListener('click', () => {
          // aggiorna punteggio
          const scores = q.scores[i] || [0,0,0,0,0,0];
          for (let c = 0; c < jobState.scores.length; c++) {
            jobState.scores[c] += scores[c] || 0;
          }
          jobState.currentIndex++;
          renderJobQuestion();
        });
        answers.appendChild(btn);
      });
      jobQuestionBox.appendChild(answers);

      const footer = document.createElement('div');
      footer.className = 'question-footer';
      footer.innerHTML = '<span>Domanda ' + (idx + 1) + ' di ' + jobQuestions.length + '</span>' +
        '<span>Rispondi di pancia, non pensarci troppo üòâ</span>';
      jobQuestionBox.appendChild(footer);
    }

    function showJobResult() {
      const scores = jobState.scores.slice();
      let bestIndex = 0;
      let bestScore = scores[0];
      for (let i = 1; i < scores.length; i++) {
        if (scores[i] > bestScore) {
          bestScore = scores[i];
          bestIndex = i;
        }
      }

      const prof = getCurrentProfile();
      const age = prof.dob ? (new Date().getFullYear() - new Date(prof.dob).getFullYear()) : null;
      const hasKids = prof.haFigli === 'si' || (prof.numFigli || 0) > 0;
      const zona = prof.zona || 'citta';

      let suggestedJob;
      switch (bestIndex) {
        case 0:
          suggestedJob = 'Tecnico / Ingegnere (es. tecnico elettronico, sviluppatore software, ingegneria leggera)';
          break;
        case 1:
          suggestedJob = 'Ambito sanitario / assistenziale (es. OSS, infermiere, fisioterapia, assistenza alla persona)';
          break;
        case 2:
          suggestedJob = 'Educazione / formazione (es. educatore, formatore, insegnante, tutor)';
          break;
        case 3:
          suggestedJob = 'Organizzazione / business (es. responsabile di area, project manager, piccolo imprenditore)';
          break;
        case 4:
          suggestedJob = 'Creativo / digitale (es. content creator, grafico, video-maker, comunicazione digitale)';
          break;
        case 5:
          suggestedJob = 'Manuale / outdoor (es. manutentore, tecnico sul campo, guida, lavori artigianali)';
          break;
        default:
          suggestedJob = 'Profilo misto: potresti muoverti tra pi√π aree senza problemi.';
      }

      let profileNote = '';
      if (hasKids) {
        profileNote += 'Hai figli: professioni con orari pi√π prevedibili potrebbero essere pi√π sostenibili. ';
      }
      if (zona === 'montagna') {
        profileNote += 'Vivere in montagna apre scenari interessanti in ambito turismo, outdoor e manutenzione sul territorio. ';
      } else if (zona === 'mare') {
        profileNote += 'Vivere al mare pu√≤ favorire ruoli legati al turismo, accoglienza e servizi stagionali. ';
      }
      if (age && age > 40) {
        profileNote += 'Con l‚Äôesperienza accumulata, ruoli dove puoi trasferire competenze (formazione, coordinamento) diventano pi√π naturali. ';
      }

      jobResultBox.innerHTML = '';
      jobResultBox.classList.remove('hidden');

      const title = document.createElement('div');
      title.className = 'result-title';
      title.textContent = 'Suggerimento principale';
      const main = document.createElement('div');
      main.className = 'result-main';
      main.textContent = suggestedJob;

      const meta = document.createElement('div');
      meta.className = 'result-meta';
      meta.textContent =
        'Questo risultato combina le tue risposte con alcuni fattori di profilo (famiglia, zona, et√†). ' +
        '√à una direzione possibile, non un verdetto definitivo. ' + profileNote;

      jobResultBox.appendChild(title);
      jobResultBox.appendChild(main);
      jobResultBox.appendChild(meta);

      addHistoryEntry('Che lavoro fa per me?', suggestedJob);
    }

    // ================== GIOCO: QUANTI FIGLI AVR√í ==================

    const kidsQuestions = [
      {
        text: 'Ti piacciono i bambini in generale?',
        factor: 3
      },
      {
        text: 'Come ti immagini il tuo tempo libero ideale?',
        factor: 2
      },
      {
        text: 'Quanto √® importante per te la tranquillit√† in casa?',
        factor: -2
      },
      {
        text: 'Come vivi l‚Äôidea di ‚Äúresponsabilit√†‚Äù a lungo termine?',
        factor: 2
      },
      {
        text: 'Ti piace organizzare e gestire caos e imprevisti?',
        factor: 2
      },
      {
        text: 'Ti attira l‚Äôidea di una famiglia numerosa?',
        factor: 3
      },
      {
        text: 'Quanto ti pesa la mancanza di sonno?',
        factor: -2
      },
      {
        text: 'Quanto ti piace stare a casa invece che uscire spesso?',
        factor: 2
      },
      {
        text: 'Quanto ti senti stabile economicamente (sensazione soggettiva)?',
        factor: 2
      },
      {
        text: 'Se pensi al rumore in casa (giochi, urla, corse‚Ä¶), come ti senti?',
        factor: 2
      }
    ];

    const kidsQuestionBox = document.getElementById('kidsQuestionBox');
    const kidsResultBox = document.getElementById('kidsResult');
    const kidsState = {
      currentIndex: 0,
      score: 0
    };

    const kidsAnswers = [
      { label: 'Per niente / pochissimo', weight: 0 },
      { label: 'Cos√¨ cos√¨', weight: 1 },
      { label: 'Abbastanza', weight: 2 },
      { label: 'Molto / tantissimo', weight: 3 }
    ];

    function renderKidsQuestion() {
      kidsResultBox.classList.add('hidden');
      const idx = kidsState.currentIndex;
      if (idx >= kidsQuestions.length) {
        showKidsResult();
        return;
      }
      const q = kidsQuestions[idx];
      kidsQuestionBox.innerHTML = '';

      const qText = document.createElement('div');
      qText.className = 'question-text';
      qText.textContent = (idx + 1) + '. ' + q.text;
      kidsQuestionBox.appendChild(qText);

      const answers = document.createElement('div');
      answers.className = 'answers-grid';
      kidsAnswers.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.innerHTML = '<span class="index">' + String.fromCharCode(65 + i) + ')</span> ' + opt.label;
        btn.addEventListener('click', () => {
          kidsState.score += opt.weight * q.factor;
          kidsState.currentIndex++;
          renderKidsQuestion();
        });
        answers.appendChild(btn);
      });
      kidsQuestionBox.appendChild(answers);

      const footer = document.createElement('div');
      footer.className = 'question-footer';
      footer.innerHTML = '<span>Domanda ' + (idx + 1) + ' di ' + kidsQuestions.length + '</span>' +
        '<span>Rispondi come ti senti davvero, non come ‚Äúdovresti‚Äù.</span>';
      kidsQuestionBox.appendChild(footer);
    }

    function showKidsResult() {
      const prof = getCurrentProfile();
      let adjustedScore = kidsState.score;

      if (prof.haFigli === 'si') {
        adjustedScore += (prof.numFigli || 0) * 3;
      }
      if (prof.sposato === 'si') {
        adjustedScore += 4;
      }
      if (prof.zona === 'montagna' || prof.zona === 'mare') {
        adjustedScore += 1;
      }
      if (prof.trasferirsi === 'si') {
        adjustedScore -= 1;
      }
      if (prof.piaceZona === 'no') {
        adjustedScore -= 2;
      }

      let range;
      if (adjustedScore <= 5) range = {min: 0, max: 1, label: '0-1 figlio (o nessuno) probabili'};
      else if (adjustedScore <= 14) range = {min: 1, max: 2, label: '1-2 figli probabili'};
      else if (adjustedScore <= 24) range = {min: 2, max: 3, label: '2-3 figli probabili'};
      else if (adjustedScore <= 34) range = {min: 3, max: 4, label: '3-4 figli probabili'};
      else range = {min: 4, max: 6, label: 'famiglia numerosa (4+ figli) probabile'};

      const predicted = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;

      kidsResultBox.innerHTML = '';
      kidsResultBox.classList.remove('hidden');

      const title = document.createElement('div');
      title.className = 'result-title';
      title.textContent = 'Stima di L‚ÄôIndovino';

      const main = document.createElement('div');
      main.className = 'result-main';
      main.textContent = predicted + ' figli (fascia: ' + range.label + ')';

      const meta = document.createElement('div');
      meta.className = 'result-meta';
      meta.textContent =
        'Questa √® una stima probabilistica basata su preferenze, stile di vita e situazione attuale. ' +
        'Non √® una profezia: le scelte di vita e gli eventi cambiano tutto.';

      kidsResultBox.appendChild(title);
      kidsResultBox.appendChild(main);
      kidsResultBox.appendChild(meta);

      addHistoryEntry('Quanti figli avr√≤?', predicted + ' (fascia: ' + range.label + ')');
    }

    // ================== GIOCO: 20 DOMANDE ==================

    // Piccolo set di oggetti con attributi booleani
    const twentyQItems = [
      { name: 'cane', animal: true, food: false, vehicle: false, indoor: true, tech: false },
      { name: 'gatto', animal: true, food: false, vehicle: false, indoor: true, tech: false },
      { name: 'pesce', animal: true, food: false, vehicle: false, indoor: false, tech: false },
      { name: 'auto', animal: false, food: false, vehicle: true, indoor: false, tech: true },
      { name: 'bicicletta', animal: false, food: false, vehicle: true, indoor: false, tech: false },
      { name: 'pizza', animal: false, food: true, vehicle: false, indoor: true, tech: false },
      { name: 'gelato', animal: false, food: true, vehicle: false, indoor: true, tech: false },
      { name: 'computer', animal: false, food: false, vehicle: false, indoor: true, tech: true },
      { name: 'telefono', animal: false, food: false, vehicle: false, indoor: true, tech: true },
      { name: 'albero', animal: false, food: false, vehicle: false, indoor: false, tech: false },
      { name: 'montagna', animal: false, food: false, vehicle: false, indoor: false, tech: false },
      { name: 'mare', animal: false, food: false, vehicle: false, indoor: false, tech: false },
      { name: 'sedia', animal: false, food: false, vehicle: false, indoor: true, tech: false },
      { name: 'libro', animal: false, food: false, vehicle: false, indoor: true, tech: false },
      { name: 'chitarra', animal: false, food: false, vehicle: false, indoor: true, tech: false }
    ];

    const attributeQuestions = [
      { key: 'animal', text: '√à un essere vivente / animale?' },
      { key: 'food', text: 'Si mangia?' },
      { key: 'vehicle', text: 'Serve principalmente per spostarsi?' },
      { key: 'tech', text: '√à un oggetto tecnologico / elettronico?' },
      { key: 'indoor', text: 'Di solito si trova in casa?' }
    ];

    const twentyQBox = document.getElementById('twentyQBox');
    const twentyQResultBox = document.getElementById('twentyQResult');
    const twentyQState = {
      candidates: [],
      questionIndex: 0,
      questionCount: 0
    };

    function startTwentyQ() {
      twentyQState.candidates = twentyQItems.slice();
      twentyQState.questionIndex = 0;
      twentyQState.questionCount = 0;
      twentyQResultBox.classList.add('hidden');
      renderTwentyQQuestion();
    }

    function resetTwentyQ() {
      twentyQBox.innerHTML = '';
      twentyQResultBox.classList.add('hidden');
      twentyQState.candidates = twentyQItems.slice();
      twentyQState.questionIndex = 0;
      twentyQState.questionCount = 0;
    }

    function renderTwentyQQuestion() {
      twentyQBox.innerHTML = '';

      if (twentyQState.candidates.length === 1) {
        const guess = twentyQState.candidates[0].name;
        showTwentyQGuess(guess, false);
        return;
      }

      if (twentyQState.questionCount >= 40) {
        showTwentyQLose();
        return;
      }

      const attr = attributeQuestions[twentyQState.questionIndex % attributeQuestions.length];

      const qText = document.createElement('div');
      qText.className = 'question-text';
      qText.textContent = 'Domanda ' + (twentyQState.questionCount + 1) + ': ' + attr.text;
      twentyQBox.appendChild(qText);

      const answers = document.createElement('div');
      answers.className = 'answers-grid';

      function answerHandler(val) {
        twentyQState.questionCount++;
        twentyQState.questionIndex++;

        if (val === 'yes') {
          twentyQState.candidates = twentyQState.candidates.filter(c => c[attr.key]);
        } else if (val === 'no') {
          twentyQState.candidates = twentyQState.candidates.filter(c => !c[attr.key]);
        } // 'maybe' mantiene tutti

        if (twentyQState.candidates.length === 0) {
          twentyQState.candidates = twentyQItems.slice();
        }

        if (twentyQState.candidates.length === 1 || twentyQState.questionCount >= 40) {
          renderTwentyQQuestion();
        } else {
          renderTwentyQQuestion();
        }
      }

      const btnYes = document.createElement('button');
      btnYes.className = 'answer-btn';
      btnYes.textContent = 'S√¨';
      btnYes.addEventListener('click', () => answerHandler('yes'));

      const btnNo = document.createElement('button');
      btnNo.className = 'answer-btn';
      btnNo.textContent = 'No';
      btnNo.addEventListener('click', () => answerHandler('no'));

      const btnMaybe = document.createElement('button');
      btnMaybe.className = 'answer-btn';
      btnMaybe.textContent = 'Non saprei / dipende';
      btnMaybe.addEventListener('click', () => answerHandler('maybe'));

      answers.appendChild(btnYes);
      answers.appendChild(btnNo);
      answers.appendChild(btnMaybe);
      twentyQBox.appendChild(answers);

      const footer = document.createElement('div');
      footer.className = 'question-footer';
      footer.innerHTML =
        '<span>Candidati rimasti: ' + twentyQState.candidates.length + '</span>' +
        '<span>Massimo 40 domande: adesso siamo a ' + (twentyQState.questionCount + 1) + '</span>';
      twentyQBox.appendChild(footer);
    }

    function showTwentyQGuess(guess, uncertain) {
      twentyQResultBox.classList.remove('hidden');
      twentyQResultBox.innerHTML = '';

      const title = document.createElement('div');
      title.className = 'result-title';
      title.textContent = 'La mia ipotesi';

      const main = document.createElement('div');
      main.className = 'result-main';
      main.textContent = uncertain
        ? 'Forse stavi pensando a: ' + guess + ' ?'
        : 'Stavi pensando a: ' + guess + '!';

      const meta = document.createElement('div');
      meta.className = 'result-meta';
      meta.textContent = uncertain
        ? 'Se non √® corretto, hai vinto: il tuo pensiero √® rimasto un mistero.'
        : 'Se ho indovinato, complimenti: sei stato coerente nelle risposte.';

      twentyQResultBox.appendChild(title);
      twentyQResultBox.appendChild(main);
      twentyQResultBox.appendChild(meta);

      addHistoryEntry('Indovina a cosa sto pensando', 'Ipotesi: ' + guess);
    }

    function showTwentyQLose() {
      twentyQResultBox.classList.remove('hidden');
      twentyQResultBox.innerHTML = '';

      const title = document.createElement('div');
      title.className = 'result-title';
      title.textContent = 'Mi hai battuto!';

      const main = document.createElement('div');
      main.className = 'result-main';
      main.textContent = 'Mi hai battuto, non riesco a leggere i tuoi pensieri!';

      const meta = document.createElement('div');
      meta.className = 'result-meta';
      meta.textContent =
        'Ho esaurito le 40 domande senza arrivare a una risposta unica. Bravo: il tuo pensiero era fuori dal mio piccolo database.';

      twentyQResultBox.appendChild(title);
      twentyQResultBox.appendChild(main);
      twentyQResultBox.appendChild(meta);

      addHistoryEntry('Indovina a cosa sto pensando', 'Non sono riuscito a indovinare üòÖ');
    }

    // ================== GIOCO: MAGIC 8 BALL ==================

    const magic8Question = document.getElementById('magic8Question');
    const magic8AskBtn = document.getElementById('magic8AskBtn');
    const magic8ClearBtn = document.getElementById('magic8ClearBtn');
    const magic8Inner = document.getElementById('magic8Inner');
    const magic8TextResult = document.getElementById('magic8TextResult');

    const yesAnswers = [
      'Molto probabile',
      'Quasi certamente s√¨',
      'Le condizioni sono favorevoli',
      'S√¨, se continui su questa strada',
      'S√¨, ma servir√† impegno costante'
    ];
    const noAnswers = [
      'Poco probabile',
      'Non nelle condizioni attuali',
      'Per il momento la risposta √® no',
      'Non contare troppo su questo',
      'Solo cambiando molto la situazione'
    ];
    const neutralAnswers = [
      'La risposta √® incerta',
      '√à presto per dirlo',
      'Dipende da una scelta che farai a breve',
      'Il quadro √® confuso, riprova pi√π avanti',
      'Pu√≤ andare in entrambe le direzioni'
    ];

    function classifyQuestion(text) {
      const t = text.toLowerCase();
      if (/riuscir[o√≤]/.test(t) || /avr[o√≤]/.test(t) || /andr√†? bene/.test(t)) {
        return 'yes';
      }
      if (/smetter[o√≤]/.test(t) || /perder[o√≤]/.test(t) || /fallir[o√≤]/.test(t)) {
        return 'no';
      }
      return 'neutral';
    }

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    magic8AskBtn.addEventListener('click', () => {
      const text = magic8Question.value.trim();
      if (!text) {
        alert('Scrivi una domanda prima.');
        return;
      }
      const type = classifyQuestion(text);
      const prof = getCurrentProfile();

      let baseAns;
      if (type === 'yes') baseAns = pickRandom(yesAnswers);
      else if (type === 'no') baseAns = pickRandom(noAnswers);
      else baseAns = pickRandom(neutralAnswers);

      // Piccola sfumatura sul profilo
      let profileHint = '';
      if (prof.lavora === 'si' && /lavor/.test(text.toLowerCase())) {
        profileHint = ' Il tuo profilo lavorativo attuale pesa molto: valuta se sei davvero soddisfatto.';
      } else if (prof.zona === 'montagna' && /trasfer/.test(text.toLowerCase())) {
        profileHint = ' Vivere in montagna rende il cambiamento pi√π impegnativo ma spesso molto gratificante.';
      }

      const finalAns = baseAns + profileHint;

      magic8Inner.textContent = baseAns;
      magic8TextResult.classList.remove('hidden');
      magic8TextResult.innerHTML = '<div class="result-title">Risposta dell‚Äôoracolo</div>' +
        '<div class="result-main">' + finalAns + '</div>' +
        '<div class="result-meta">Ricorda: √® un gioco. Le decisioni vere restano tue.</div>';

      addHistoryEntry('Magic 8 Ball', baseAns);
    });

    magic8ClearBtn.addEventListener('click', () => {
      magic8Question.value = '';
      magic8Inner.textContent = 'Fai\nuna domanda';
      magic8TextResult.classList.add('hidden');
    });

    // ================== GIOCO: TAROCCHI ==================

    const tarotDrawBtn = document.getElementById('tarotDrawBtn');
    const tarotResetBtn = document.getElementById('tarotResetBtn');
    const tarotResult = document.getElementById('tarotResult');

    const tarotDeck = [
      {
        name: 'Il Mago',
        key: 'mago',
        meaning: 'Iniziativa, creativit√†, capacit√† di trasformare idee in azione.'
      },
      {
        name: 'La Papessa',
        key: 'papessa',
        meaning: 'Intuizione, ascolto interiore, bisogno di fermarsi a capire.'
      },
      {
        name: 'L‚ÄôImperatrice',
        key: 'imperatrice',
        meaning: 'Crescita, famiglia, progetti che si sviluppano nel tempo.'
      },
      {
        name: 'L‚ÄôImperatore',
        key: 'imperatore',
        meaning: 'Struttura, responsabilit√†, costruzione solida nel lungo periodo.'
      },
      {
        name: 'Il Matto',
        key: 'matto',
        meaning: 'Nuovi inizi, cambiamento, buttarsi con coraggio (ma non alla cieca).'
      },
      {
        name: 'La Ruota',
        key: 'ruota',
        meaning: 'Cicli che si chiudono e si aprono, occasioni da cogliere.'
      },
      {
        name: 'La Forza',
        key: 'forza',
        meaning: 'Coraggio tranquillo, capacit√† di reggere periodi intensi.'
      },
      {
        name: 'La Temperanza',
        key: 'temperanza',
        meaning: 'Equilibrio, conciliazione tra esigenze diverse, tempo di integrazione.'
      }
    ];

    function drawTarotCards() {
      const deckCopy = tarotDeck.slice();
      const draw = [];
      for (let i = 0; i < 3; i++) {
        const idx = Math.floor(Math.random() * deckCopy.length);
        draw.push(deckCopy.splice(idx, 1)[0]);
      }
      const prof = getCurrentProfile();

      tarotResult.classList.remove('hidden');
      tarotResult.innerHTML = '';

      const title = document.createElement('div');
      title.className = 'result-title';
      title.textContent = 'Lettura a 3 carte';
      tarotResult.appendChild(title);

      const positions = ['Presente', 'Sfida', 'Possibile esito'];
      draw.forEach((card, i) => {
        const line = document.createElement('div');
        line.className = 'result-main';
        let extra = '';
        if (card.key === 'imperatrice' && (prof.haFigli === 'si' || prof.numFigli > 0)) {
          extra = ' (famiglia e cura delle relazioni sono particolarmente centrali per te).';
        }
        if (card.key === 'mago' && prof.lavora === 'si') {
          extra = ' (il lavoro attuale o un progetto personale pu√≤ essere il canale di questa energia).';
        }
        line.textContent = positions[i] + ' ‚Äì ' + card.name + ': ' + card.meaning + extra;
        tarotResult.appendChild(line);
      });

      const meta = document.createElement('div');
      meta.className = 'result-meta';
      meta.textContent =
        'Questa √® una lettura simbolica, non deterministica. Usa ci√≤ che risuona come spunto di riflessione.';
      tarotResult.appendChild(meta);

      addHistoryEntry('Tarocchi', draw.map(c => c.name).join(', '));
    }

    tarotDrawBtn.addEventListener('click', drawTarotCards);
    tarotResetBtn.addEventListener('click', () => {
      tarotResult.classList.add('hidden');
    });

    // ================== INIT ==================

    renderProfiles();
    updateCurrentProfileLabel();
    renderHistory();
  </script>
</body>
</html>
